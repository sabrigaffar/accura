# ๐ ุฅุตูุงุญ ูุนุงูุฌุฉ Session ุนูุฏ ุญุฐู ุงูุจูุงูุงุช

**ุชุงุฑูุฎ:** 2025-10-26  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ

---

## ๐ด ุงููุดููุฉ

**ุงูุณููุงุฑูู:**
1. ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ูุน "ุชุฐูุฑูู" โ
2. Supabase ูุญูุธ Session ูู AsyncStorage
3. ุงููุทูุฑ ูุญุฐู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ๐๏ธ
4. ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู
5. โ **ุงูุชุทุจูู ููุชุญ ุชููุงุฆูุงู ูููู ุนูู ูุงุฌูุฉ ุงูุนููู (ุฎุทุฃ!)**

**ุงูุณุจุจ:**
```typescript
// ูู index.tsx - ุงูููุฏ ุงููุฏูู
const { data: profile } = await supabase
  .from('profiles')
  .select('user_type')
  .eq('id', session.user.id)
  .single();

if (profile) {
  setUserType(profile.user_type);
}
// โ ุงููุดููุฉ: ุฅุฐุง ูู ูุฌุฏ profileุ ูุง ููุนู ุดูุก!
// โ userType ูุจูู null
// โ ูุชู ุงูุชูุฌูู ููุงุฌูุฉ ุงูุนููู (default)
```

---

## โ ุงูุญู

### ุงูุชุบููุฑุงุช ูู index.tsx:

```typescript
const { data: profile, error } = await supabase
  .from('profiles')
  .select('user_type')
  .eq('id', session.user.id)
  .single();

// โ ุงูุญู: ุฅุฐุง ูู ูุฌุฏ profileุ ูุณุฌู ุฎุฑูุฌ
if (!profile || error) {
  console.log('Profile not found, signing out...');
  await supabase.auth.signOut();
  setSession(null);
  setUserType(null);
  setLoading(false);
  return;
}

setUserType(profile.user_type);
```

**ุงููุชูุฌุฉ:**
- โ ุฅุฐุง ูุงู ููุงู Session ููู ุจุฏูู Profile
- โ ูุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุชููุงุฆูุงู
- โ ูููุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ูุง ูุฏุฎู ุงูุชุทุจูู ุจุญุงูุฉ ุบูุฑ ุตุญูุญุฉ

---

## ๐ฏ ุงูุญุงูุงุช ุงููุฎุชููุฉ

### ุงูุญุงูุฉ 1: Session ุตุญูุญุฉ + Profile ููุฌูุฏ โ
```
Session โ โ Profile โ โ user_type ููุฌูุฏ
โ ุงูุชูุฌูู ูููุงุฌูุฉ ุงูุตุญูุญุฉ
```

### ุงูุญุงูุฉ 2: Session ุตุญูุญุฉ + Profile ูุญุฐูู โ๏ธ
```
Session โ โ Profile โ (ูุญุฐูู ูู DB)
โ ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู
โ ุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

### ุงูุญุงูุฉ 3: ูุง ููุฌุฏ Session โ
```
Session โ
โ ุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

### ุงูุญุงูุฉ 4: ุฎุทุฃ ูู ุงูุฌูุจ ๐ด
```
Error ูู ุฌูุจ Profile
โ ุชุณุฌูู ุฎุฑูุฌ ููุฃูุงู
โ ุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

---

## ๐ ุงูุฃูุงู

**ูุจู:**
- โ Session ููุฌูุฏุฉ ุจุฏูู profile ุตุญูุญ
- โ ุงูุชุทุจูู ููุชุญ ุจุญุงูุฉ ุบูุฑ ุขููุฉ
- โ ูุฏ ูุคุฏู ูุฃุฎุทุงุก ูู ุงูููุฏ

**ุจุนุฏ:**
- โ Session ุชุชุทุงุจู ุฏุงุฆูุงู ูุน Profile
- โ ูุง ูููู ุงูุฏุฎูู ุจุฏูู ุจูุงูุงุช ุตุญูุญุฉ
- โ ุญูุงูุฉ ูู ุงูุญุงูุงุช ุบูุฑ ุงููุชููุนุฉ

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุญุฐู Profile โ
```
1. ุณุฌูู ุฏุฎูู ูุน "ุชุฐูุฑูู"
2. ุฃุบูู ุงูุชุทุจูู
3. ุงุญุฐู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Supabase
4. ุงูุชุญ ุงูุชุทุจูู
5. โ ูุฌุจ ุฃู ููุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู (ูููุณ ุงูุนููู)
```

### ุงุฎุชุจุงุฑ 2: Session ุนุงุฏูุฉ โ
```
1. ุณุฌูู ุฏุฎูู ูุชุงุฌุฑ
2. ุฃุบูู ุงูุชุทุจูู
3. ุงูุชุญ ุงูุชุทุจูู
4. โ ูุฌุจ ุฃู ููุชุญ ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ
```

### ุงุฎุชุจุงุฑ 3: ุชุณุฌูู ุฎุฑูุฌ ูุฏูู โ
```
1. ุณุฌูู ุฏุฎูู
2. ุงุถุบุท "ุชุณุฌูู ุฎุฑูุฌ"
3. ุงูุชุญ ุงูุชุทุจูู
4. โ ูุฌุจ ุฃู ููุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

---

## ๐ก ููุงุญุธุงุช ุฅุถุงููุฉ

### ุนู "ุชุฐูุฑูู" (Remember Me)

**ููู ูุนูู:**
```typescript
// ูู login.tsx
if (rememberMe) {
  // Session ุชูุญูุธ ูู AsyncStorage
  // ุชุจูู ุญุชู ุจุนุฏ ุฅุบูุงู ุงูุชุทุจูู
} else {
  // Session ูุคูุชุฉ ููุท
  // ุชูุญุฐู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู
}
```

**ุงููุงุฆุฏุฉ:**
- โ ุงููุณุชุฎุฏู ูุง ูุญุชุงุฌ ูุชุณุฌูู ุฏุฎูู ูู ูุฑุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู

**ุงูุฎุทุฑ (ูุจู ุงูุฅุตูุงุญ):**
- โ Session ูุฏ ุชุจูู ุจุนุฏ ุญุฐู ุงูุจูุงูุงุช
- โ ุงูุชุทุจูู ููุชุญ ุจุญุงูุฉ ุฎุงุทุฆุฉ

**ุจุนุฏ ุงูุฅุตูุงุญ:**
- โ Session ุชููุญุต ุฏุงุฆูุงู
- โ ุฅุฐุง ูุงูุช ุบูุฑ ุตุญูุญุฉุ ุชูุญุฐู

---

## ๐ ุชุฏูู ุงููุนุงูุฌุฉ

```
โโโโโโโโโโโโโโโโโโโ
โ ูุชุญ ุงูุชุทุจูู    โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ ุฌูุจ Session     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โโโโ ูุง ููุฌุฏ Session โโโ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ ุฌูุจ Profile     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โโโโ Profile ููุฌูุฏ โโโ ุงูุชูุฌูู ุญุณุจ user_type
         โ                      (merchant/driver/customer)
         โ
         โโโโ Profile ูุญุฐูู โโโ ุชุณุฌูู ุฎุฑูุฌ
         โ                      โ
         โ                   ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
         โ
         โโโโ ุฎุทุฃ โโโโโโโโโโโ ุชุณุฌูู ุฎุฑูุฌ (ููุฃูุงู)
                              โ
                           ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
```

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

**ุงูุชุทุจูู ุงูุขู:**
- โ ุขูู ูู Sessions ุงููุนููุฉ
- โ ูุง ููุชุญ ุจุญุงูุฉ ุฎุงุทุฆุฉ
- โ ูุชุนุงูู ูุน ุฌููุน ุงูุญุงูุงุช ุงูุญุฏูุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ

**ุฅุฐุง ุญุฐูุช ุจูุงูุงุช ูุณุชุฎุฏู:**
- โ Session ุชูุญุฐู ุชููุงุฆูุงู
- โ ุงููุณุชุฎุฏู ููุทูุจ ููู ุชุณุฌูู ุฏุฎูู ูุฌุฏุฏุงู
- โ ูุง ุชูุฌููุงุช ุฎุงุทุฆุฉ

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-10-26 22:30  
**ุงููุทูุฑ:** Cascade AI  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ

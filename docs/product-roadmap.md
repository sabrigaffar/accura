# Product Roadmap

This document tracks the prioritized backlog and 90‑day roadmap. It is derived from the comparative analysis versus Talabat and our current app architecture.

## الأهداف
- بناء منصة موثوقة موجّهة للعربية تدعم أدواراً متعددة (عميل، تاجر، سائق) مع آليات تشغيل ونمو قوية.
- سدّ الفجوات الرئيسية مقارنة بتطبيق طلبات: المدفوعات، القسائم/الولاء، تخصيص الاكتشاف/البحث، تقدير زمن الوصول (ETA)، أدوات التاجر، والعمليات التشغيلية.

---

## المرحلة 1 — 0–30 يوم (أولوية عالية)

- المدفوعات (أساسية)
  - النطاق: دمج بوابة دفع مناسبة للسوق، دعم البطاقات + Apple/Google Pay + الدفع عند الاستلام، تخزين المعاملات، تدفقات الاسترداد.
  - التقنية: شاشات الدفع تحت `app/`، جداول قاعدة بيانات `payments` و`payment_transactions`، Webhook/Trigger لتحديث حالة الطلب.
  - مؤشرات الأداء: نسبة نجاح > 95%، زمن إتمام الدفع < 15 ثانية.

- قسائم خصم أساسية
  - النطاق: أكواد قسائم بنافذة صلاحية وحدود استخدام (للمستخدم/عمومي) وأنواع خصم بسيطة.
  - التقنية: جدول `coupons` وسياسات RLS، التحقق عند الدفع.
  - مؤشرات الأداء: تطبيق خصم صحيح، صفر تكرار استغلال.

- ETA (بدائي)
  - النطاق: مسافة + سرعة متوسطة (heuristic)؛ عرض ETA في واجهات العميل والسائق.
  - التقنية: أدوات وواجهات في `app/(driver-tabs)/index.tsx` وشاشات تتبع الطلب للعميل.
  - مؤشرات الأداء: دقة ETA ضمن ±20% لأكثر من 80% من الرحلات.

- موثوقية الإشعارات
  - النطاق: تحسين تدفقات تسجيل Push Token وTriggers في قاعدة البيانات؛ إضافة إعادة المحاولة وتسجيل الأحداث.
  - التقنية: Triggers Supabase ضمن `supabase/migrations/*dispatch_push*`، و`contexts/PushNotificationContext`.
  - مؤشرات الأداء: أقل من 1% إشعارات فائتة على الأجهزة المؤهلة.

---

## المرحلة 2 — 30–60 يوم (أولوية متوسطة)

- المحفظة والاسترداد
  - النطاق: محفظة لكل مستخدم مع رصيد وعمليات إيداع/سحب/استرداد؛ ربط التسويات بالطلبات.
  - التقنية: جداول `wallets` و`wallet_transactions` ووظائف التسويات.
  - مؤشرات الأداء: دقة المصالحة، انخفاض معدل النزاعات.

- عضوية بسيطة (Pro)
  - النطاق: خطة شهرية مع عدد X من التوصيلات المجانية أو تخفيض الرسوم.
  - التقنية: جداول `memberships`، فحص الاستحقاق في الدفع.
  - مؤشرات الأداء: تحسن الاحتفاظ، زيادة تكرار الطلب.

- خيارات/مُعدِّلات التاجر
  - النطاق: خيارات (أحجام/إضافات)، تركيب السعر، جداول الإتاحة.
  - التقنية: جداول `product_options` و`option_values`، واجهات التاجر تحت `app/merchant/`.
  - مؤشرات الأداء: نسبة الكتالوج الذي يستخدم الخيارات، ارتفاع متوسط سلة الشراء.

- دعم داخل التطبيق
  - النطاق: تذاكر/دردشة (MVP) لكل الأدوار؛ استخدام مخطط الشكاوى الحالي كأساس.
  - التقنية: `supabase/migrations/20251107224500_complaints.sql`، واجهات الدعم.
  - مؤشرات الأداء: زمن أول استجابة، رضا العملاء (CSAT).

---

## المرحلة 3 — 60–90 يوم (متقدمة)

- تخصيص الاكتشاف/البحث
  - النطاق: ترتيب الصفحة الرئيسية/البحث باستخدام إشارات المشاهدة/النقر/الشراء.
  - التقنية: خط تسجيل أحداث، خدمة حساب درجات، خطافات ترتيب في الواجهة.
  - مؤشرات الأداء: تحسن CTR/Conversion في الرئيسية والبحث.

- ETA متقدم وتوجيه السائق
  - النطاق: ETA ديناميكي مع المرور؛ Batching بسيط وتعدد نقاط التسليم.
  - التقنية: خدمة heuristics للمسارات، تكامل مع تطبيق السائق.
  - مؤشرات الأداء: نسبة التسليم في الوقت، استغلالية السائق.

- الولاء والمستويات
  - النطاق: كسب/حرق نقاط، مزايا حسب المستويات.
  - التقنية: جداول `loyalty_points` و`tiers`، محرّك قواعد للاحتساب.
  - مؤشرات الأداء: معدل تكرار الشراء، متوسط قيمة الطلب.

- تكاملات التاجر
  - النطاق: طابعة حرارية/تكامل POS للشركاء الرئيسيين.
  - التقنية: طبقة تكامل، تخزين آمن للاعتمادات.
  - مؤشرات الأداء: زمن معالجة الطلب، رضا الشركاء.

---

## مهام هندسية شاملة

- المراقبة: تتبع الأخطاء، مؤشرات الأداء، سجلات التدقيق.
- الأمان: تقوية RLS، وظائف SECURITY DEFINER، إدارة الأسرار.
- البيانات: تهيئة أحداث التحليلات، عروض BI خفيفة.

---

## روابط إلى ملفات المشروع الحالية
- شاشة السائق الرئيسية والإحصائيات: `app/(driver-tabs)/index.tsx`
- الإشعارات والصوت: `utils/soundPlayer.ts` وTriggers Supabase: `supabase/migrations/*dispatch_push*`
- التقييمات: RPC `create_review` وواجهة `app/order/[id]/rate.tsx`
- تعديل المتجر والمنيو: `app/merchant/edit-store/[id].tsx`

---

## الخطوات التالية
- اختيار بوابة الدفع لمرحلة 1 وتحديد الأسواق/العملات المستهدفة.
- فتح تذاكر GitHub لكل عنصر Backlog مع معايير قبول وKPIs.
- متابعة أسبوعية لمراجعة التقدم والتسليمات.

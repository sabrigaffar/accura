# ๐ ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทููุจุฉ

ุชุงุฑูุฎ: 2025-10-28

---

## ๐ด **ุงููุดููุฉ 1: ุงูููุชุฌุงุช ุชุธูุฑ ูู ุฌููุน ุงููุชุงุฌุฑ**

### ุงูุณุจุจ:
- ุงูุชุงุฌุฑ ูููู ูุชุฌุฑูู (ุชูุฑุชุฉ + ููุชูุณููู)
- ููุง ุงููุชุฌุฑูู ูููุง ููุณ `owner_id`
- ุงูููุฏ ูุฌูุจ ุงูููุชุฌุงุช ุจุงุณุชุฎุฏุงู `owner_id` ุจุฏูุงู ูู `store_id`
- ุงููุชูุฌุฉ: ูู ุงูููุชุฌุงุช ุชุธูุฑ ูู ูู ุงููุชุงุฌุฑ!

### ุงูุญู:
โ **ุชู ุงูุชูููุฐ:**
1. ุฅุถุงูุฉ `store_id` ุฅูู ุฌุฏูู `products` (Migration: `fix_products_store_association.sql`)
2. ุชุญุฏูุซ ููุฏ `app/merchant/[id].tsx` ููุณุชุฎุฏู `store_id`

**SQL Migration:**
```sql
ALTER TABLE products ADD COLUMN store_id UUID REFERENCES merchants(id);
```

**Code Fix:**
```typescript
.eq('store_id', storeId)  // โ ุจุฏูุงู ูู merchant_id
```

---

## ๐ด **ุงููุดููุฉ 2: ุฑุณูู ุงูุชูุตูู (ูุฌุงูู vs ูุฏููุน vs ุจุงููุณุงูุฉ)**

### ุงูุณุจุจ:
- ูุชุฌุฑ 1: `delivery_fee = 0` (ูุฌุงูู)
- ูุชุฌุฑ 2: `delivery_fee = 10` (ุซุงุจุช)
- ุงููุธุงู ูุญุณุจ ุฃูุถุงู ุจุงููุณุงูุฉ (`calculated_delivery_fee`)
- ุชุนุงุฑุถ: ููู ููุฏูุน ููุณุงุฆู ุฅุฐุง ูุงู ุงููุชุฌุฑ ูุฌุงููุ

### ุงูุญู ุงูููุชุฑุญ:

#### **ุงูุณููุงุฑูู 1: ุงููุชุฌุฑ ูุฌุงูู (`delivery_fee = 0`)**
- ุงูุนููู: ูุง ูุฏูุน ุฑุณูู ุชูุตูู โ
- ุงูุณุงุฆู: ูุญุตู ุนูู ุฑุณูู ุฃุณุงุณูุฉ ุซุงุจุชุฉ (ูุซูุงู 5 ุฌููู) ูู ุงูููุตุฉ

#### **ุงูุณููุงุฑูู 2: ุงููุชุฌุฑ ุจุฑุณูู ุซุงุจุชุฉ (`delivery_fee = 10`)**
- ุงูุนููู: ูุฏูุน 10 ุฌููู
- ุงูุณุงุฆู: ูุญุตู ุนูู ูุณุจุฉ (ูุซูุงู 70% = 7 ุฌููู)
- ุงูููุตุฉ: ุชุฃุฎุฐ 30% (3 ุฌููู)

#### **ุงูุณููุงุฑูู 3: ุญุณุงุจ ุจุงููุณุงูุฉ (`calculated_delivery_fee`)**
- ุงูุนููู: ูุฏูุน ุญุณุจ ุงููุณุงูุฉ (10 ุฌููู/ูู)
- ุงูุณุงุฆู: ูุญุตู ุนูู ูุณุจุฉ (ูุซูุงู 80% ูู ุงูุฑุณูู ุงููุญุณูุจุฉ)
- ุงูููุตุฉ: ุชุฃุฎุฐ 20%

**ุชู ุฅูุดุงุก:**
- ุฏุงูุฉ SQL: `calculate_driver_earnings()` ูู `fix_delivery_fee_logic.sql`

**ุงููุณุจ ุงูููุชุฑุญุฉ (ูุงุจูุฉ ููุชุนุฏูู):**
```sql
- ูุชุฌุฑ ูุฌุงูู: ุงูุณุงุฆู = 5 ุฌููู ุซุงุจุช
- ูุชุฌุฑ ุจุฑุณูู ุซุงุจุชุฉ: ุงูุณุงุฆู = 70%
- ุญุณุงุจ ุจุงููุณุงูุฉ: ุงูุณุงุฆู = 80%
```

---

## ๐ด **ุงููุดููุฉ 3: ุงูุนููุฉ (ุฑูุงู vs ุฌููู ูุตุฑู)**

### ุงูุณุจุจ:
- ุงูุชุงุฌุฑ ุถุจุท ุงูุนููุฉ ุนูู "ุฌููู ูุตุฑู"
- ููู ุงูุชุทุจูู ูุนุฑุถ "ุฑูุงู" ูู ูู ููุงู (hardcoded)

### ุงูุญู:

#### **ุงูุฎูุงุฑ 1: ุงุณุชุฎุฏุงู Currency ูู AsyncStorage (ููุฌูุฏ ุญุงููุงู)**
```typescript
const [currency, setCurrency] = useState('ุฑูุงู');
// ูุชู ุชุญูููู ูู AsyncStorage
```

**ุงููุดููุฉ:** hardcoded "ุฑูุงู" ูู 40+ ููุงู ูู ุงูููุฏ!

#### **ุงูุฎูุงุฑ 2: Constants ุนุงูุฉ**
ุฅูุดุงุก ููู:
```typescript
// constants/currency.ts
export const CURRENCY_SYMBOL = 'ุฌููู'; // ุฃู ุชุญูููู ูู ุงูุฅุนุฏุงุฏุงุช
```

#### **ุงูุฎูุงุฑ 3: Context ุนุงูุฉ**
```typescript
// contexts/CurrencyContext.tsx
export const useCurrency = () => {
  const [currency] = useState('ุฌููู'); // ูู AsyncStorage
  return currency;
};
```

### **ุงูุชูุตูุฉ:**
ุงุณุชุฎุฏุงู **Constant** ุจุณูุท:

**ุงููููุงุช ุงูุชู ุชุญุชุงุฌ ุชุญุฏูุซ:**
- `app/merchant/[id].tsx`
- `app/checkout.tsx`
- `app/order/[id].tsx`
- `app/cart.tsx`
- `app/(tabs)/merchants.tsx`
- `app/(merchant-tabs)/*.tsx`

**ุฅุฌูุงูู:** ~40 ูููุน

---

## ๐ฏ **ุฎุทุฉ ุงูุชูููุฐ ุงูููุตู ุจูุง:**

### **ุงูุขู (ุนุงุฌู):**
1. โ **ุชุดุบูู Migration:** `fix_products_store_association.sql`
2. โ **ุงูููุฏ ูุญุฏุซ** ูู `merchant/[id].tsx`
3. โณ **ุชุดุบูู Migration:** `fix_delivery_fee_logic.sql`

### **ุจุนุฏ ุงูุงุฎุชุจุงุฑ:**
4. โณ **ุฅูุดุงุก:** `constants/currency.ts`
5. โณ **ุงุณุชุจุฏุงู:** "ุฑูุงู" โ `{CURRENCY}` ูู ูู ุงููููุงุช

---

## โ๏ธ **ููุงุญุธุฉ ูููุฉ:**

**ุงููุดููุฉ 1 (ุงูููุชุฌุงุช)** ูู **ุงูุฃูู** ููุฌุจ ุญููุง ููุฑุงู!

**ุงููุดููุฉ 2 (ุฑุณูู ุงูุชูุตูู)** ุชุญุชุงุฌ **ูุฑุงุฑ ูู ุตุงุญุจ ุงููุดุฑูุน** ุจุฎุตูุต ูููุฐุฌ ุงูุนูู

**ุงููุดููุฉ 3 (ุงูุนููุฉ)** ุณููุฉ ููู ุชุญุชุงุฌ **ุชุนุฏูู 40+ ููู** - ูููู ุชุฃุฌูููุง

---

## ๐ **ุงูุฃููููุฉ:**

| ุงููุดููุฉ | ุงูุฃููููุฉ | ุงูุญุงูุฉ | ุงูููุช ุงููุชููุน |
|---------|----------|--------|---------------|
| 1. ุงูููุชุฌุงุช | ๐ด ุนุงุฌูุฉ | โ ุฌุงูุฒ | ููุฑู |
| 2. ุฑุณูู ุงูุชูุตูู | ๐ก ูุชูุณุทุฉ | โณ ูุญุชุงุฌ ูุฑุงุฑ | 30 ุฏูููุฉ |
| 3. ุงูุนููุฉ | ๐ข ููุฎูุถุฉ | โณ ุฌุงูุฒ ููุชูููุฐ | ุณุงุนุฉ |

---

## โ **ุงูุฎุทูุฉ ุงูุชุงููุฉ:**

1. **ุดุบูู SQL:** `fix_products_store_association.sql`
2. **ุงุฎุชุจุฑ:** ุงูุชุญ ูุชุฌุฑ ุงูุชูุฑุชุฉ ููุชุฌุฑ ุงูููุชูุณููู
3. **ุชุญูู:** ูู ูุชุฌุฑ ูุนุฑุถ ููุชุฌุงุชู ููุท
4. **ูุฑุฑ:** ูููุฐุฌ ุฑุณูู ุงูุชูุตูู ุงูููุงุณุจ
5. **ููุฐ:** ุชุญุฏูุซ ุงูุนููุฉ (ุฅุฐุง ูุฒู ุงูุฃูุฑ)

# ๐ ูุธุงู ุงููุตุงุฏูุฉ - Authentication System

ุฏููู ุดุงูู ููุธุงู ุงููุตุงุฏูุฉ ุงููุญุฏูุซ ูู ุชุทุจูู Accura

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุทุฑู ุงููุตุงุฏูุฉ](#ุทุฑู-ุงููุตุงุฏูุฉ)
3. [ุงูุดุงุดุงุช ูุงูููุฒุงุช](#ุงูุดุงุดุงุช-ูุงูููุฒุงุช)
4. [ููููุฉ ุงูุงุณุชุฎุฏุงู](#ููููุฉ-ุงูุงุณุชุฎุฏุงู)
5. [ุงูุฃูุงู](#ุงูุฃูุงู)
6. [ุงุณุชูุดุงู ุงูุฃุฎุทุงุก](#ุงุณุชูุดุงู-ุงูุฃุฎุทุงุก)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ

ุชู ุชุญุฏูุซ ูุธุงู ุงููุตุงุฏูุฉ ูู **OTP ููุท** ุฅูู ูุธุงู **Email/Phone + Password** ุฃูุซุฑ ูุฑููุฉ:

| **ุงูุณุงุจู** | **ุงูุญุงูู** |
|------------|-----------|
| โ OTP ุฅูุฒุงูู ุนุจุฑ ุงููุงุชู | โ Email + Password |
| โ ูุง ููุฌุฏ ูููุฉ ูุฑูุฑ | โ Phone + Password |
| โ ุงููุงุชู ุฅูุฒุงูู | โ ุฑูู ุงููุงุชู ุงุฎุชูุงุฑู |
| โ ุชุณุฌูู ุฏุฎูู ุณุฑูุน | โ ุฎูุงุฑุงุช ูุชุนุฏุฏุฉ |

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

- โ **ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุฑูุฏ ุฃู ุงููุงุชู** ูุน ูููุฉ ูุฑูุฑ
- โ **ุงูุชุณุฌูู ุจุงูุจุฑูุฏ** + ูููุฉ ูุฑูุฑ (ุงููุงุชู ุงุฎุชูุงุฑู)
- โ **ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ** ุนุจุฑ Email ุฃู Phone
- โ **Remember Me** ูุญูุธ ุงูุฌูุณุฉ
- โ **ุชุจุฏูู ุฐูู** ุจูู Email ู Phone ูู ูุงุฌูุฉ ูุงุญุฏุฉ

---

## ๐ ุทุฑู ุงููุตุงุฏูุฉ

### 1. ุชุณุฌูู ุงูุฏุฎูู (Login)

#### โ๏ธ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
```typescript
Email: user@example.com
Password: โขโขโขโขโขโขโขโข
```

#### ๐ฑ ุนุจุฑ ุฑูู ุงููุงุชู
```typescript
Phone: +966xxxxxxxxx ุฃู 05xxxxxxxx
Password: โขโขโขโขโขโขโขโข
```

**ุงููููุงุช:**
- `app/auth/login.tsx` - ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู ุงูููุญุฏุฉ

**ุงูููุฒุงุช:**
- โ ุชุจุฏูู ุณุฑูุน ุจูู Email/Phone
- โ Remember Me toggle
- โ ุงูุชุญูู ุงูุชููุงุฆู ูู ุตูุบุฉ Email/Phone
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

---

### 2. ุงูุชุณุฌูู (Sign Up)

#### ๐ ุงูุจูุงูุงุช ุงููุทููุจุฉ

| ุงูุญูู | ุฅูุฒุงูู | ุงููุตู |
|------|-------|-------|
| ุงูุงุณู ุงููุงูู | โ | ุงุณู ุงููุณุชุฎุฏู |
| ุงูุจุฑูุฏ ุงูุฅููุชุฑููู | โ | ูููุตุงุฏูุฉ ูุงูุชูุงุตู |
| ูููุฉ ุงููุฑูุฑ | โ | 6 ุฃุญุฑู ุนูู ุงูุฃูู |
| ุฑูู ุงููุงุชู | โ | ููุชูุซูู/ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ |
| ููุน ุงููุณุชุฎุฏู | โ | Customer/Merchant/Driver |

**ุงููููุงุช:**
- `app/auth/signup.tsx` - ุดุงุดุฉ ุงูุชุณุฌูู ุงููุญุฏุซุฉ

**ููุงุญุธุงุช:**
- โ ุฑูู ุงููุงุชู **ุงุฎุชูุงุฑู** ุงูุขู
- โ ุงูุชูุฌูู ุงูุชููุงุฆู ุญุณุจ ููุน ุงููุณุชุฎุฏู
- โ ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุนุจุฑ ุฑุงุจุท Supabase

---

### 3. ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ (Forgot Password)

#### โ๏ธ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
1. ุฅุฏุฎุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. ุงุณุชูุงู ุฑุงุจุท ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ
3. ูุชุญ ุงูุฑุงุจุท ูุฅุฏุฎุงู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ

#### ๐ฑ ุนุจุฑ ุฑูู ุงููุงุชู (OTP)
1. ุฅุฏุฎุงู ุฑูู ุงููุงุชู
2. ุงุณุชูุงู ุฑูุฒ OTP (6 ุฃุฑูุงู)
3. ุฅุฏุฎุงู OTP + ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
4. ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ููุฑุงู

**ุงููููุงุช:**
- `app/auth/forgot-password.tsx` - ุดุงุดุฉ ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ

---

## ๐ฅ๏ธ ุงูุดุงุดุงุช ูุงูููุฒุงุช

### ๐ฑ ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู (`login.tsx`)

```typescript
Features:
โโโ Email/Phone Switcher (ุชุจุฏูู ุฐูู)
โโโ Remember Me Toggle
โโโ Password Input (ุขูู)
โโโ Forgot Password Link
โโโ Sign Up Link
```

**ูุงุฌูุฉ ุงููุณุชุฎุฏู:**
- ๐จ ุชุตููู ุนุตุฑู ููุธูู
- ๐ ุชุจุฏูู ุณูุณ ุจูู Email/Phone
- โ ุงูุชุญูู ุงูููุฑู ูู ุงูุจูุงูุงุช
- ๐ ุฏุนู Dark Mode (ุฅุฐุง ููุนูู)

---

### ๐ ุดุงุดุฉ ุงูุชุณุฌูู (`signup.tsx`)

```typescript
Fields:
โโโ Full Name (ุฅูุฒุงูู)
โโโ Email (ุฅูุฒุงูู)
โโโ Phone (ุงุฎุชูุงุฑู) โ ุฌุฏูุฏ!
โโโ Password (ุฅูุฒุงูู)
โโโ Confirm Password (ุฅูุฒุงูู)
โโโ User Type Selector
```

**ุงูุชุญุฏูุซุงุช ุงูุฑุฆูุณูุฉ:**
- โ ุฅุฒุงูุฉ OTP ุงูุฅูุฒุงูู
- โ ุฌุนู ุฑูู ุงููุงุชู ุงุฎุชูุงุฑู
- โ ุงูุชุณุฌูู ุงููุจุงุดุฑ ุจู Email + Password
- โ ุชุฃููุฏ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

---

### ๐ ุดุงุดุฉ ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ (`forgot-password.tsx`)

```typescript
Methods:
โโโ Email Reset (ุฑุงุจุท ุนุจุฑ ุงูุจุฑูุฏ)
โโโ Phone Reset (OTP + ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ)
```

**ุงููููุฒุงุช:**
- ๐ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุงุณุชุฑุฌุงุน
- ๐ง ุฑุงุจุท ุขูู ุนุจุฑ ุงูุจุฑูุฏ
- ๐ฑ OTP ููุฑู ุนุจุฑ ุงููุงุชู
- โ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ูุจุงุดุฑุฉ

---

## ๐ป ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู

#### 1. ุชุณุฌูู ุงูุฏุฎูู ุงูุจุฑูุฌู

```typescript
import { supabase } from '@/lib/supabase';

// ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุฑูุฏ
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123',
});

// ุชุณุฌูู ุงูุฏุฎูู ุจุงููุงุชู
const { data, error } = await supabase.auth.signInWithPassword({
  phone: '+966500000000',
  password: 'password123',
});
```

#### 2. ุงูุชุณุฌูู ุงูุจุฑูุฌู

```typescript
// ูุน ุงูุจุฑูุฏ ููุท
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    data: {
      full_name: 'ุงุณู ุงููุณุชุฎุฏู',
      role: 'customer',
    },
  },
});

// ูุน ุงูุจุฑูุฏ ูุงููุงุชู
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  phone: '+966500000000',
  password: 'password123',
  options: {
    data: {
      full_name: 'ุงุณู ุงููุณุชุฎุฏู',
      role: 'customer',
      phone: '+966500000000',
    },
  },
});
```

#### 3. ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ ุงูุจุฑูุฌู

```typescript
// ุนุจุฑ ุงูุจุฑูุฏ
const { error } = await supabase.auth.resetPasswordForEmail(
  'user@example.com',
  { redirectTo: 'accura://reset-password' }
);

// ุนุจุฑ OTP
const { error } = await supabase.auth.signInWithOtp({
  phone: '+966500000000',
});

// ุงูุชุญูู ูู OTP ูุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
const { error: verifyError } = await supabase.auth.verifyOtp({
  phone: '+966500000000',
  token: '123456',
  type: 'sms',
});

const { error: updateError } = await supabase.auth.updateUser({
  password: 'new_password',
});
```

---

### ูููุณุชุฎุฏููู ุงูููุงุฆููู

#### โ ุชุณุฌูู ุงูุฏุฎูู

1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฎุชุฑ **ุชุณุฌูู ุงูุฏุฎูู**
3. ุงุฎุชุฑ **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ุฃู **ุฑูู ุงููุงุชู**
4. ุฃุฏุฎู ุจูุงูุงุชู + ูููุฉ ุงููุฑูุฑ
5. ูุนูู **ุชุฐูุฑูู** ุฅุฐุง ุฃุฑุฏุช (ุงุฎุชูุงุฑู)
6. ุงุถุบุท **ุชุณุฌูู ุงูุฏุฎูู**

#### โ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ

1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฎุชุฑ **ุฅูุดุงุก ุญุณุงุจ**
3. ุงุฎุชุฑ ููุน ุงูุญุณุงุจ (ุนููู/ุชุงุฌุฑ/ุณุงุฆู)
4. ุฃุฏุฎู:
   - ุงูุงุณู ุงููุงูู โ
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู โ
   - ุฑูู ุงููุงุชู (ุงุฎุชูุงุฑู) โ
   - ูููุฉ ุงููุฑูุฑ โ
5. ุงุถุบุท **ุฅูุดุงุก ุญุณุงุจ**
6. ุชุญูู ูู ุจุฑูุฏู ุงูุฅููุชุฑููู โ๏ธ

#### โ ูุณูุช ูููุฉ ุงููุฑูุฑุ

**ุนุจุฑ ุงูุจุฑูุฏ:**
1. ุงุถุบุท **ูุณูุช ูููุฉ ุงููุฑูุฑุ**
2. ุงุฎุชุฑ **ุงูุจุฑูุฏ**
3. ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู
4. ุงูุชุญ ุจุฑูุฏู ูุงุถุบุท ุนูู ุงูุฑุงุจุท
5. ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ

**ุนุจุฑ ุงููุงุชู:**
1. ุงุถุบุท **ูุณูุช ูููุฉ ุงููุฑูุฑุ**
2. ุงุฎุชุฑ **ุงููุงุชู**
3. ุฃุฏุฎู ุฑูู ูุงุชูู
4. ุงุณุชูู OTP (6 ุฃุฑูุงู)
5. ุฃุฏุฎู OTP + ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
6. ุงุถุบุท **ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ**

---

## ๐ ุงูุฃูุงู

### ูุนุงููุฑ ุงูุฃูุงู ุงููุทุจูุฉ

#### โ ูููุงุช ุงููุฑูุฑ
- ๐ ุงูุญุฏ ุงูุฃุฏูู: 6 ุฃุญุฑู
- ๐ ุงูุชุดููุฑ: bcrypt (Supabase)
- ๐ ูุง ูุชู ุญูุธ ูููุงุช ุงููุฑูุฑ ูู plain text

#### โ ุงูุฌูุณุงุช
- ๐ JWT Tokens ูู Supabase
- ๐ Refresh Tokens ุชููุงุฆู
- ๐ Session Persistence ุนุจุฑ AsyncStorage
- ๐ ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู ุนูุฏ ุฅูุบุงุก "ุชุฐูุฑูู"

#### โ ุงูุชุญูู ูู ุงูุจุฑูุฏ
- โ ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฅูุฒุงูู
- โ ุฑูุงุจุท ุขููุฉ ุฐุงุช ุตูุงุญูุฉ ูุญุฏูุฏุฉ
- โ Deep linking ููุนูุฏุฉ ููุชุทุจูู

#### โ OTP
- โ ุฑููุฒ ุนุดูุงุฆูุฉ 6 ุฃุฑูุงู
- โ ุตูุงุญูุฉ ูุญุฏูุฏุฉ (5-10 ุฏูุงุฆู)
- โ ูุฑุฉ ูุงุญุฏุฉ ููุท (One-Time)

#### โ RLS (Row Level Security)
- โ ุณูุงุณุงุช ุฃูุงู ูู Supabase
- โ ูู ูุณุชุฎุฏู ูุฑู ุจูุงูุงุชู ููุท
- โ ุญูุงูุฉ ูู SQL Injection

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "Invalid login credentials"

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉ
2. โ ุงูุญุณุงุจ ุบูุฑ ููุนูู (ูู ูุชู ุชุฃููุฏ ุงูุจุฑูุฏ)
3. โ ุฑูู ุงููุงุชู ุจุตูุบุฉ ุฎุงุทุฆุฉ

**ุงูุญููู:**
- โ ุชุญูู ูู ุจูุงูุงุชู
- โ ุงุณุชุฎุฏู **ูุณูุช ูููุฉ ุงููุฑูุฑุ**
- โ ุชุฃูุฏ ูู ุชุฃููุฏ ุจุฑูุฏู ุงูุฅููุชุฑููู
- โ ุงุณุชุฎุฏู ุงูุตูุบุฉ ุงูุตุญูุญุฉ ูููุงุชู: `+966xxxxxxxxx`

---

### ุงููุดููุฉ: "Email not confirmed"

**ุงูุณุจุจ:**
- ูู ูุชู ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุนุฏ ุงูุชุณุฌูู

**ุงูุญู:**
1. ุงูุชุญ ุจุฑูุฏู ุงูุฅููุชุฑููู
2. ุงุจุญุซ ุนู ุฑุณุงูุฉ ูู Supabase
3. ุงุถุบุท ุนูู ุฑุงุจุท ุงูุชุฃููุฏ
4. ุงุฑุฌุน ููุชุทุจูู ูุณุฌูู ุงูุฏุฎูู

---

### ุงููุดููุฉ: "User already registered"

**ุงูุณุจุจ:**
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุฌู ูุณุจูุงู

**ุงูุญู:**
- โ ุงุณุชุฎุฏู **ุชุณุฌูู ุงูุฏุฎูู** ุจุฏูุงู ูู ุฅูุดุงุก ุญุณุงุจ
- โ ุฃู ุงุณุชุฎุฏู **ูุณูุช ูููุฉ ุงููุฑูุฑุ** ุฅุฐุง ูุณูุชูุง

---

### ุงููุดููุฉ: OTP ูุง ูุตู

**ุงูุฃุณุจุงุจ:**
1. โ ุฑูู ุงููุงุชู ุฎุงุทุฆ
2. โ ูุดููุฉ ูู ุฎุฏูุฉ SMS
3. โ ุญุธุฑ ูู ูุฒูุฏ ุงูุฎุฏูุฉ

**ุงูุญููู:**
- โ ุชุญูู ูู ุฑูู ุงููุงุชู
- โ ุงุณุชุฎุฏู **ุงุณุชุฑุฌุงุน ุนุจุฑ ุงูุจุฑูุฏ** ุจุฏูุงู ูู ุงููุงุชู
- โ ุงูุชุธุฑ ุฏูููุฉ ูุญุงูู ูุฑุฉ ุฃุฎุฑู

---

## ๐ ูุฎุทุท ุงูุชุฏูู

```
                    ุชุทุจูู Accura
                         |
           +-------------+-------------+
           |                           |
      ุชุณุฌูู ุงูุฏุฎูู              ุฅูุดุงุก ุญุณุงุจ
           |                           |
    +------+------+           +--------+--------+
    |             |           |                 |
  Email         Phone      Email            Email+Phone
    |             |           |                 |
 Password      Password    Password          Password
    |             |           |                 |
    +------+------+           +--------+--------+
           |                           |
      Remember Me?              Email Verification
           |                           |
    +------+------+           +--------+--------+
    |             |           |        |        |
   Yes           No        Customer Merchant Driver
    |             |           |        |        |
  Session     Session        Setup   Setup   Setup
  Saved      Temp            |        |        |
    |             |           +--------+--------+
    +------+------+                   |
           |                     Main App
      Main App                   (tabs)
       (tabs)
```

---

## ๐ ููุงุญุธุงุช ูููุทูุฑูู

### ุงูุชูุงูู ูุน Supabase

```typescript
// ูู lib/supabase.ts
import AsyncStorage from '@react-native-async-storage/async-storage';

const supabase = createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY,
  {
    auth: {
      storage: AsyncStorage,
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: false,
    },
  }
);
```

### Deep Linking ููู Password Reset

ูู `app.json`:
```json
{
  "expo": {
    "scheme": "accura"
  }
}
```

ูู Supabase Dashboard:
```
Redirect URLs: accura://reset-password
```

---

## ๐ ูุฑุงุฌุน

- [Supabase Auth Docs](https://supabase.com/docs/guides/auth)
- [Expo SecureStore](https://docs.expo.dev/versions/latest/sdk/securestore/)
- [React Navigation](https://reactnavigation.org/docs/auth-flow)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชุญุฏูุซ ูุธุงู ุงููุตุงุฏูุฉ ุจูุฌุงุญ ููููู:
- โ **ุฃูุซุฑ ูุฑููุฉ** - Email ุฃู Phone
- โ **ุฃูุซุฑ ุฃูุงูุงู** - ูููุงุช ูุฑูุฑ ูููุฉ
- โ **ุฃุณูู ุงุณุชุฎุฏุงูุงู** - ูุงุฌูุงุช ุจุณูุทุฉ
- โ **ูุชูุงูู ูุน ุงููุนุงููุฑ** - Supabase Auth

**ุงููููุงุช ุงูุฑุฆูุณูุฉ:**
- `app/auth/login.tsx` - ุชุณุฌูู ุงูุฏุฎูู
- `app/auth/signup.tsx` - ุงูุชุณุฌูู (ูุญุฏูุซ)
- `app/auth/forgot-password.tsx` - ุงุณุชุฑุฌุงุน ูููุฉ ุงููุฑูุฑ

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐**

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-10-26
**ุงูุฅุตุฏุงุฑ:** 2.0
